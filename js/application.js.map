{"version":3,"sources":["application.js"],"names":["escapeHtml","string","String","replace","s","entityMap","escapeRegExp","shuffleArray","array","i","length","j","Math","floor","random","temp","showWord","index","window","timelineWordsArray","data","words","word","$","timeline","pos","html","append","css","outerWidth","hide","fadeIn","draggable","cursor","dragListener","time","_time","event","ui","is","this","addClass","dropListener","ga","x","parseInt","y","currentWord","removeClass","initializeCanvas","canvas","fabric","Canvas","isDrawingMode","width","getWidth","height","getHeight","Image","fromURL","img","set","top","left","clipTo","ctx","w","h","r","beginPath","moveTo","arcTo","closePath","add","sendToBack","Rect","fill","strokeWidth","stroke","rx","ry","opacity","windowIsLoaded","addDetailsToCanvas","load","$id","show","repeat","str","chr","Array","join","text","tokens","nameOnCertificate","toUpperCase","split","lines","lineLimit","lineText","push","addUnderline","styles",0,"match","_tokens","_i","textDecoration","_text","IText","fontFamily","fontSize","centerH","Text","format","date","now","Line","downloadPledge","_canvas","attr","href","toDataURL","download","click","id","document","getElementById","Reveal","initialize","controls","progress","transition","backgroundTransition","margin","minScale","maxScale","history","center","on","next","addEventListener","previousSlide","currentSlide","find","popup","remove","cookie","selectric","iCheck","checkboxClass","value","val","toLowerCase","&","<",">","\"","'","/","schoolname","schoolnames","stopPropagation","name","target","has","debounce","keyword","schoolnamesArray","foundValues","pattern","RegExp","test","prop","end","parents","fields","serializeArray","isOnError","error","inArray","isNaN","expires","droppable","accept","over","out","tolerance","drop","location","studentName","className","prev","prototype","_renderCharDecoration","styleDeclaration","offset","charWidth","charHeight","indexOf","fillRect","_fontSizeFraction","_fontSizeMult"],"mappings":"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","file":"application.js","sourcesContent":["// micro optimization\nvar $id = function(id) {\n  return $(document.getElementById(id));\n};\n\nvar currentWord = 0;\nvar windowIsLoaded = false;\nvar _canvas = null;\nvar nameOnCertificate = '';\n\nReveal.initialize({\n  controls: true,\n  progress: true,\n  width: 1200,\n  height: 853,\n  transition: 'fade',\n  backgroundTransition: 'fade',\n  margin: 0.0,\n  minScale: 0.2,\n  maxScale: 2,\n  controls: true,\n  progress: true,\n  history: true,\n  center: true,\n  transition: 'convex'\n});\n\n$('button.play-btn').on('click', function() {\n  Reveal.next();\n});\n\nReveal.addEventListener('slidechanged', function(event) {\n  var previousSlide = $(event.previousSlide);\n  var currentSlide = $(event.currentSlide);\n\n  if (previousSlide.find('iframe[data-autoplay]').length > 0) {\n    $('div.reveal').removeClass('dark');\n  }\n\n  if (previousSlide.find('div.interactive-3').length > 0) {\n    $id('pledge-name-form').popup('hide');\n  }\n\n  if (currentSlide.find('iframe[data-autoplay]').length > 0) {\n    $('div.reveal').addClass('dark');\n\n    ga('send', 'event', 'Video', 'play', currentSlide.find('h1').text());\n  }\n\n  if (currentSlide.find('div.interactive-1').length > 0 && (currentWord === 0 && currentSlide.find('div.skinny:not(.preload)').length < 1)) {\n    $('div.preload').remove();\n    showWord(currentWord);\n  }\n\n  if (currentSlide.find('div.interactive-4').length > 0 && nameOnCertificate !== '') {\n    _canvas = initializeCanvas();\n  }\n\n  ga('send', 'pageview', '/' + currentSlide.attr('id').replace(/#/, ''));\n});\n\n$id('show-second-block').on('click', function() {\n  $id('first-block').hide();\n  $id('second-block').show();\n});\n\nif ($.cookie('show_intro_form') !== '1') {\n  $id('intro-form')\n    .show()\n    .popup('show');\n}\n\n$('select').selectric();\n$(':checkbox').iCheck({\n  checkboxClass: 'icheckbox_minimal-blue'\n});\n\n$id('schoolrole').on('change', function() {\n  var value = $(this).val();\n\n  if (value.toLowerCase() === 'other') {\n    $id('schoolroleother').show();\n  } else {\n    $id('schoolroleother').hide();\n  }\n});\n\nvar entityMap = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  \"/\": '&#x2F;'\n};\n\nfunction escapeHtml(string) {\n  return String(string).replace(/[&<>\"'\\/]/g, function (s) {\n    return entityMap[s];\n  });\n}\n\nvar schoolname = $id('schoolname');\nvar schoolnames = $id('schoolnames');\n\nschoolnames\n  .on('click', 'li', function(event) {\n    event.stopPropagation();\n\n    var name = $(this).text();\n\n    schoolname.val(name);\n\n    schoolnames\n      .removeClass('has-values')\n      .html('');\n  });\n\n$(document).on('click', function(event) {\n  if (!schoolname.is(event.target) || (!schoolnames.is(event.target) && schoolnames.has(event.target).length === 0)) {\n    schoolnames\n      .removeClass('has-values')\n      .html('');\n  }\n});\n\nfunction escapeRegExp(string){\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n}\n\nschoolname\n  .on('input propertychange', $.debounce(function() {\n    var keyword = $(this).val();\n\n    var schoolnamesArray = window.schoolnamesArray || [];\n\n    schoolnames\n      .removeClass('has-values')\n      .html('');\n\n    if (keyword) {\n      keyword = escapeRegExp(keyword);\n\n      var foundValues = [];\n\n      for (var i = 0; i < schoolnamesArray.length; i++) {\n        var name = schoolnamesArray[i].replace(/(\\(|\\))/g, '');\n        var pattern = new RegExp('^' + keyword + '|\\\\s' + keyword + '.*', 'ig');\n\n        if (pattern.test(name)) {\n          foundValues.push(schoolnamesArray[i]);\n        }\n      }\n\n      if (foundValues.length > 0) {\n        schoolnames.addClass('has-values');\n\n        for (var i = 0; i < foundValues.length; i++) {\n          schoolnames.append('<li>' + escapeHtml(foundValues[i]) + '</li>');\n        };\n      }\n    }\n  }, 500));\n\n$id('agree')\n  .on('ifChecked', function() {\n    $id('submit-intro-form').prop('disabled', false);\n  })\n  .on('ifUnchecked', function() {\n    $id('submit-intro-form').prop('disabled', true);\n  });\n\n$id('second-block')\n  .find('input[type=text], input[type=number], input[type=email]')\n    .on('input propertychange', function() {\n      $(this).removeClass('error');\n    })\n  .end()\n  .find('select')\n    .on('change', function() {\n      $(this).parents('.selectric-wrapper').removeClass('error');\n    });\n\n$id('second-block')\n  .on('submit', function() {\n    $(this).find('input[type=text], input[type=number], input[type=email], .selectric-wrapper').removeClass('error');\n\n    var fields = $(this).serializeArray();\n    var isOnError = false;\n\n    for (var i = 0; i < fields.length; i++) {\n      var id = '';\n      var error = '';\n\n      if ($.inArray(fields[i].name, ['agree', 'schoolroleother']) !== -1) {\n        continue;\n      }\n\n      if (fields[i].value === '') {\n        error = 'Field is required.';\n      } else if (fields[i].name === 'email' && !/\\.edu\\.au$/i.test(fields[i].value)) {\n        error = 'Email address must contain \".edu.au\".';\n      } else if (fields[i].name === 'totalstudents' && parseInt(fields[i].value) === isNaN) {\n        error = 'Field expects a number.';\n      } else if (fields[i].name === 'schoolrole' && fields[i].value.toLowerCase() === 'other' && $id('schoolroleother').val() === '') {\n        id = 'schoolroleother';\n        error = 'Please specify your role.';\n      }\n\n      if (error) {\n        id = (id) ? id : fields[i].name;\n\n        if ($id(id).parents('.selectric-wrapper').length > 0) {\n          $id(id).parents('.selectric-wrapper').addClass('error');\n        } else {\n          $id(id).addClass('error');\n        }\n\n        isOnError = true;\n      }\n    };\n\n    if (!isOnError) {\n      /* $\n        .ajax({\n          type: 'POST',\n          url: '',\n          crossDomain: true,\n          data: $(this).serialize()\n        })\n        .done(function() {\n          $.cookie('show_intro_form', '1', {expires: 0.5});\n          $id('intro-form').popup('hide');\n\n          ga('send', 'event', 'Form', 'submit', 'Initial form');\n        }); */\n      $.cookie('show_intro_form', '1', {expires: 0.5});\n      $id('intro-form').popup('hide');\n\n      ga('send', 'event', 'Form', 'submit', 'Initial form');\n    }\n\n    return false;\n  });\n\nfunction shuffleArray(array) {\n  for (var i = array.length - 1; i > 0; i--) {\n    var j = Math.floor(Math.random() * (i + 1));\n    var temp = array[i];\n    array[i] = array[j];\n    array[j] = temp;\n  }\n\n  return array;\n}\n\nwindow.timelineWordsArray = shuffleArray(window.timelineWordsArray);\n\nfunction showWord(index) {\n  if (index < window.timelineWordsArray.length) {\n    var data = window.timelineWordsArray[index];\n    var words = data.words.replace(/\\n/g, '<br>');\n\n    var word = $('<div class=\"skinny words\" data-' + data.timeline + ' data-x=\"' + data.pos[0] + '\" data-y=\"' + data.pos[1] + '\" style=\"top: 15px;\"></div>')\n      .html(words);\n\n    $('div.interactive-1').append(word);\n\n    word\n      .css('left', ($('div.interactive-1').outerWidth() / 2) - (word.outerWidth() / 2))\n      .hide()\n      .fadeIn()\n      .draggable({\n        cursor: 'move'\n      });\n  }\n}\n\nfunction dragListener(time) {\n  var _time = time;\n\n  return function(event, ui) {\n    if (ui.draggable.is('[data-' + _time + ']')) {\n      $(this).addClass('drop-active');\n    }\n  };\n}\n\nfunction dropListener(time) {\n  var _time = time;\n\n  return function(event, ui) {\n    if (!ui.draggable.is('[data-' + _time + ']')) {\n      ga('send', 'event', 'Timeline', 'incorrect', ui.draggable.html().replace(/<br>/g, ''));\n      return;\n    }\n\n    ga('send', 'event', 'Timeline', 'correct', ui.draggable.html().replace(/<br>/g, ''));\n\n    var x = parseInt(ui.draggable.data('x'), 10);\n    var y = parseInt(ui.draggable.data('y'), 10);\n\n    ui.draggable\n      .addClass('minimize')\n      .css('left', x)\n      .css('top', y)\n      .draggable('disable');\n\n    showWord(++currentWord);\n\n    $(this).removeClass('drop-active');\n  };\n}\n\n$('.before.dropzone').droppable({\n  accept: '.words',\n  over: dragListener('before'),\n  out: function(event, ui) {\n    $(this).removeClass('drop-active');\n  },\n  tolerance: 'touch',\n  drop: dropListener('before')\n});\n\n$('.after.dropzone').droppable({\n  accept: '.words',\n  over: dragListener('after'),\n  out: function(event, ui) {\n    $(this).removeClass('drop-active');\n  },\n  tolerance: 'touch',\n  drop: dropListener('after')\n});\n\n$(window).load(function() {\n  windowIsLoaded = true;\n\n  if (!!(window.location + '').match(/page-10/)) {\n    $('div.preload').remove();\n    showWord(currentWord); // have to wait for the custom font to load\n  }\n});\n\n$('.box button').on('click', function() {\n  ga('send', 'event', 'Button', 'click', $(this).attr('name'));\n\n  $(this)\n    .next()\n      .show()\n    .end()\n    .remove();\n});\n\n$('div.interactive-3 li').on('click', function() {\n  $('div.interactive-3 li').removeClass('checked');\n  $(this).addClass('checked');\n\n  ga('send', 'event', 'Pledge', 'select', $(this).text());\n\n  $id('pledge-name-form').popup('show');\n});\n\n$id('enter-pledge-name').on('click', function() {\n  var studentName = $id('student-name').val();\n  var className = $id('class-name').val();\n\n  if (studentName || className) {\n    nameOnCertificate = studentName || className;\n\n    ga('send', 'event', 'Form', 'enter-pledge-name', nameOnCertificate);\n\n    Reveal.next();\n  }\n\n  return false;\n});\n\n$id('create-new-pledge').on('click', function() {\n  ga('send', 'event', 'Button', 'click', 'Create another pledge');\n\n  nameOnCertificate = '';\n\n  Reveal.prev();\n});\n\nfabric.IText.prototype._renderCharDecoration = function(ctx, styleDeclaration, left, top, offset, charWidth, charHeight) {\n  var textDecoration = styleDeclaration\n        ? (styleDeclaration.textDecoration || this.textDecoration)\n        : this.textDecoration;\n\n  if (!textDecoration) {\n    return;\n  }\n\n  if (textDecoration.indexOf('underline') > -1) {\n    ctx.fillRect(\n      left,\n      top + charHeight / 10,\n      charWidth,\n      1\n    );\n  }\n  if (textDecoration.indexOf('line-through') > -1) {\n    ctx.fillRect(\n      left,\n      top - charHeight * (this._fontSizeFraction + this._fontSizeMult - 1) + charHeight / 15,\n      charWidth,\n      charHeight / 15\n    );\n  }\n  if (textDecoration.indexOf('overline') > -1) {\n    ctx.fillRect(\n      left,\n      top - (this._fontSizeMult - this._fontSizeFraction) * charHeight,\n      charWidth,\n      charHeight / 15\n    );\n  }\n};\n\nfunction initializeCanvas() {\n  var canvas = new fabric.Canvas('certificate', {\n    isDrawingMode: true\n  });\n\n  var width = canvas.getWidth() - 5;\n  var height = canvas.getHeight() - 5;\n\n  fabric.Image.fromURL('images/page36/certificate-bg.png', function(img) {\n    img.set({\n      top: 0,\n      left: 0,\n      width: width,\n      height: height,\n      clipTo: function(ctx) {\n        var x = -((width / 2) - 1);\n        var y = -((height / 2) - 1);\n        var w = width;\n        var h = height;\n        var r = 40;\n\n        if (w < 2 * r) {\n          r = w / 2;\n        }\n\n        if (h < 2 * r) {\n          r = h / 2;\n        }\n\n        ctx.beginPath();\n        ctx.moveTo(x + r, y);\n        ctx.arcTo(x + w, y, x + w, y + h, r);\n        ctx.arcTo(x + w, y + h, x, y + h, r);\n        ctx.arcTo(x, y + h, x, y, r);\n        ctx.arcTo(x, y, x + w, y, r);\n        ctx.closePath();\n      }\n    });\n\n    canvas.add(img);\n\n    img.sendToBack();\n  });\n\n  canvas.add(new fabric.Rect({\n      top: 0,\n      left: 0,\n      width: width,\n      height: height,\n      fill: '',\n      strokeWidth: 5,\n      stroke: '#7DB2DB',\n      rx: 40,\n      ry: 40\n    }));\n\n    canvas.add(new fabric.Rect({\n      top: 5,\n      left: 5,\n      width: width - 5,\n      height: height - 5,\n      fill: '#FFF',\n      opacity: 0.4,\n      rx: 38,\n      ry: 38\n    }));\n\n  fabric.Image.fromURL('images/dove-logo2.png', function(img) {\n    img.set({\n      top: 50,\n      left: 50,\n      width: 181,\n      height: 123\n    });\n\n    canvas.add(img);\n  });\n\n  if (!windowIsLoaded) {\n    $(window).load(function() {\n      addDetailsToCanvas(canvas, width, height);\n    });\n  } else {\n    addDetailsToCanvas(canvas, width, height);\n  }\n\n  $id('download-pledge').show();\n  $id('create-new-pledge').show();\n\n  return canvas;\n}\n\nfunction repeat(str, chr){\n  chr = chr || 1;\n  return Array(chr).join(str);\n}\n\nfunction addDetailsToCanvas(canvas, width, height) {\n  var text = '';\n\n  if ($('div.interactive-3 li.checked').length < 1) {\n    text = $('div.interactive-3 li:eq(0)').text();\n  } else {\n    text = $('div.interactive-3 li.checked').text();\n  }\n\n  var tokens = ('\"' + nameOnCertificate + '\" ' + text.toUpperCase()).split(' ');\n  var lines = [];\n  var lineLimit = 40;\n  var lineText = '';\n\n  for (var i = 0; i < tokens.length; i++) {\n    if (lineText !== '') {\n      if ((lineText + ' ' + tokens[i]).length > lineLimit) {\n        lines.push(lineText);\n        lineText = tokens[i];\n      } else {\n        lineText += ' ' + tokens[i];\n      }\n    } else {\n      lineText = tokens[i];\n    }\n  }\n\n  lines.push(lineText);\n\n  var addUnderline = false;\n\n  for (var i = 0; i < lines.length; i++) {\n    var styles = {0: {}};\n\n    if (lines[i].match(/\"/)) {\n      var _tokens = lines[i].split('');\n\n      for (var _i = 0; _i < _tokens.length; _i++) {\n        if (_tokens[_i] === '\"') {\n          if (addUnderline === false) {\n            addUnderline = true;\n          } else if (addUnderline === true) {\n            addUnderline = false;\n          }\n        } else if (addUnderline) {\n          styles[0][_i] = {\n            textDecoration: 'underline'\n          };\n        }\n      }\n    }\n\n    var _text = new fabric.IText(lines[i], {\n      fontFamily: 'skinnycaps',\n      fontSize: 80,\n      left: 100,\n      top: 200 + (60 * i),\n      width: width - 120\n    });\n\n    canvas.add(_text);\n\n    _text.centerH();\n  }\n\n  canvas.add(new fabric.Text('Signed ' + repeat(' ', 11) + ' Date ' + $.format.date($.now(), 'MMMM d, yyyy'), {\n    fontFamily: 'skinnycaps',\n    fontSize: 80,\n    top: height - 100,\n    left: 90\n  }));\n\n  canvas.add(new fabric.Line([10, height - 28, 270, height - 28], {\n    left: 230,\n    top: height - 27,\n    stroke: '#000',\n    strokeWidth: 2\n  }));\n\n  canvas.add(new fabric.Line([10, height - 28, 385, height - 28], {\n    left: 628,\n    top: height - 27,\n    stroke: '#000',\n    strokeWidth: 2\n  }));\n}\n\nfunction downloadPledge(){\n  if (_canvas !== null) {\n    $('<a>').attr({\n      href: _canvas.toDataURL(),\n      download: 'certificate.png'\n    })[0].click();\n\n    ga('send', 'event', 'Button', 'click', 'Download this pledge');\n  }\n}\n\n$id('download-pledge').on('click', function() {\n  downloadPledge();\n});\n\n\n"],"sourceRoot":"/source/"}